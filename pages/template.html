<div class="page-container" id="template-page">
    <div class="page-content" style="max-height: calc(100vh - 80px); overflow: hidden;">
        <div class="template-layout">
            <!-- Sidebar -->
            <div class="template-sidebar">
                <div class="sidebar-header">
                    <button id="btn-new-template" class="primary-btn w-full justify-center">
                        <span class="btn-icon">+</span> New Message
                    </button>
                </div>
                <div class="sidebar-content">
                    <h3 class="sidebar-section-title">Saved Templates</h3>
                    <div id="template-list" class="template-list">
                        <!-- Templates rendered here -->
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Main Editor -->
            <div class="template-editor">
                <div class="editor-header">
                    <div class="header-top">
                        <h2 class="editor-title">
                            Template Editor
                        </h2>
                        <button id="btn-delete-template" class="icon-btn text-red hidden" title="Delete Template">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>

                    <!-- Inline Template Name Input -->
                    <div class="header-input-group">
                        <input type="text" id="template-name-input" class="template-name-input"
                            placeholder="Template Name (e.g. Welcome Message)">
                        <!-- Hidden ID for updates -->
                        <input type="hidden" id="template-id-hidden">
                    </div>
                </div>

                <div class="editor-content">
                    <form id="message-form">

                        <!-- Device & Recipient -->
                        <div class="form-section row">
                            <div class="form-group flex-1">
                                <label class="form-label">Select Device</label>
                                <select id="session-select" class="form-select">
                                    <option value="">Loading devices...</option>
                                </select>
                            </div>
                            <div class="form-group flex-1">
                                <label class="form-label">Receiver Phone</label>
                                <input type="text" id="phone-input" class="form-input" placeholder="e.g. 919876543210">
                            </div>
                        </div>

                        <!-- Message Type -->
                        <div class="form-section">
                            <label class="form-label">Message Type</label>
                            <div class="type-selector" id="type-selector">
                                <button type="button" class="type-btn active" data-type="text">Text</button>
                                <button type="button" class="type-btn" data-type="text_media">Text + Media</button>
                                <button type="button" class="type-btn" data-type="button">Buttons</button>
                                <button type="button" class="type-btn" data-type="button_media">Buttons + Media</button>
                            </div>
                        </div>

                        <!-- Media Section (Hidden by default) -->
                        <div id="media-section" class="form-section hidden bg-panel-light p-4 rounded">
                            <div class="flex justify-between items-center mb-2">
                                <label class="form-label mb-0">Media Attachment</label>
                                <div class="toggle-group">
                                    <button type="button" class="toggle-btn active" data-source="url">URL</button>
                                    <button type="button" class="toggle-btn" data-source="file">Upload</button>
                                </div>
                            </div>
                            <div class="row gap-2">
                                <select id="media-type-select" class="form-select w-auto">
                                    <option value="image">Image</option>
                                    <option value="video">Video</option>
                                </select>
                                <input type="text" id="media-url-input" class="form-input flex-1"
                                    placeholder="https://example.com/image.jpg">
                                <input type="file" id="media-file-input" class="hidden flex-1">
                                <label for="media-file-input" id="media-file-label"
                                    class="file-upload-label hidden flex-1">Choose File</label>
                            </div>
                            <!-- Valid Preview Container -->
                            <div id="media-preview-container"
                                class="mt-3 hidden p-2 bg-gray-900/50 rounded text-center border border-dashed border-gray-700">
                                <img id="media-preview-image" src="" class="max-h-48 mx-auto rounded shadow-lg hidden"
                                    alt="Media Preview">
                                <video id="media-preview-video" src="" class="max-h-48 mx-auto rounded shadow-lg hidden"
                                    controls></video>
                                <p id="media-preview-text" class="text-xs text-muted mt-2 hidden"></p>
                            </div>
                        </div>

                        <!-- Message Body -->
                        <div class="form-section">
                            <label class="form-label" id="body-label">Message Body</label>
                            <textarea id="message-body" class="form-input" rows="5"
                                placeholder="Type your message here..."></textarea>
                        </div>

                        <!-- Footer (Hidden by default) -->
                        <div id="footer-section" class="form-section hidden footer-panel">
                            <label class="form-label">Footer Text (Optional)</label>
                            <input type="text" id="footer-input" class="form-input"
                                placeholder="Add a short footer text...">
                        </div>

                        <!-- Buttons (Hidden by default) -->
                        <div id="buttons-section" class="form-section hidden border-t pt-4">
                            <div class="row split-row mb-3">
                                <label class="form-label mb-0">Interactive Buttons (Max 3)</label>
                                <button type="button" id="btn-add-button" class="secondary-btn small">
                                    <span class="icon">+</span> Add Button
                                </button>
                            </div>
                            <div id="buttons-list" class="buttons-list">
                                <!-- Buttons injected here -->
                            </div>
                        </div>

                        <!-- Status & Action -->
                        <div id="status-message" class="status-box hidden"></div>

                        <!-- Form Actions -->
                        <div class="editor-footer" id="main-footer">
                            <button type="button" id="btn-save-template" class="action-btn secondary">
                                <span class="icon">ðŸ’¾</span> <span id="save-btn-text">Save Template</span>
                            </button>
                            <button type="button" id="btn-send-message" class="action-btn primary">
                                <span class="icon">ðŸš€</span> Send Message
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Premium Layout & Variables */
    :root {
        --glass-bg: rgba(30, 41, 59, 0.7);
        --glass-border: rgba(255, 255, 255, 0.08);
        --accent-gradient: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        --input-bg: rgba(15, 23, 42, 0.6);
        --hover-bg: rgba(59, 130, 246, 0.1);
    }

    .page-container {
        height: 100%;
        background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.05), transparent 40%);
    }

    .template-layout {
        display: flex;
        height: 100%;
        gap: 1.5rem;
        padding: 1rem;
    }

    /* Sidebar Styling */
    .template-sidebar {
        width: 320px;
        display: flex;
        flex-direction: column;
        background: var(--bg-panel);
        border: 1px solid var(--border-light);
        border-radius: 20px;
        padding: 1.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(12px);
    }

    .sidebar-header {
        margin-bottom: 2rem;
    }

    .sidebar-section-title {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: var(--text-muted);
        margin-bottom: 1rem;
        font-weight: 700;
        opacity: 0.8;
    }

    .template-list {
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding-right: 5px;
    }

    .template-item {
        padding: 1rem;
        background: var(--bg-main);
        border: 1px solid transparent;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .template-item:hover {
        background: var(--hover-bg);
        border-color: rgba(59, 130, 246, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .template-item.active {
        background: rgba(59, 130, 246, 0.15);
        border-color: var(--primary);
        box-shadow: 0 0 0 1px var(--primary);
    }

    /* Main Editor Premium Look */
    .template-editor {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--bg-panel);
        border: 1px solid var(--border-light);
        border-radius: 24px;
        padding: 2.5rem;
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(16px);
        position: relative;
        overflow: hidden;
    }

    /* Header & Input */
    .editor-header {
        margin-bottom: 2.5rem;
        border-bottom: 1px solid var(--border-light);
        padding-bottom: 1.5rem;
    }

    .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .editor-title {
        font-size: 1.8rem;
        font-weight: 800;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin: 0;
    }

    .header-input-group {
        position: relative;
        width: 100%;
    }

    .template-name-input {
        width: 100%;
        background: var(--input-bg);
        border: 1px solid var(--border-light);
        color: var(--text-main);
        font-size: 1.1rem;
        padding: 1rem 1.2rem;
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .template-name-input:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(15, 23, 42, 0.8);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    .template-name-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }

    /* Form Fields */
    .form-section {
        margin-bottom: 2rem;
    }

    .row {
        display: flex;
        gap: 1.5rem;
    }

    .split-row {
        justify-content: space-between;
        align-items: center;
    }

    .flex-1 {
        flex: 1;
    }

    .form-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.75rem;
        display: block;
    }

    .form-input,
    .form-select {
        width: 100%;
        padding: 0.9rem 1rem;
        background: var(--input-bg);
        border: 1px solid var(--border-light);
        border-radius: 10px;
        font-size: 1rem;
        color: var(--text-main);
        transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        outline: none;
    }

    /* Type Selector */
    .type-selector {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
        background: rgba(0, 0, 0, 0.2);
        padding: 6px;
        border-radius: 14px;
        border: 1px solid var(--border-light);
    }

    .type-btn {
        background: transparent;
        border: none;
        padding: 12px;
        color: var(--text-muted);
        font-weight: 600;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .type-btn.active {
        background: var(--bg-panel);
        color: var(--primary);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .type-btn.active {
        background: var(--primary);
        color: white;
    }

    /* Footer Buttons */
    .editor-footer {
        margin-top: 3rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-light);
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        align-items: center;
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.9rem 1.8rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
    }

    .action-btn.secondary {
        background: transparent;
        border: 1px solid var(--border-light);
        color: var(--text-main);
    }

    .action-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--text-muted);
        transform: translateY(-1px);
    }

    .action-btn.primary {
        background: var(--accent-gradient);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    }

    .action-btn.primary:hover {
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        transform: translateY(-2px) scale(1.02);
    }

    /* Utilities */
    .hidden {
        display: none !important;
    }

    .w-auto {
        width: auto;
    }
</style>

<script type="module" src="js/template_manager.js?v=7"></script>