<div class="template-grid-container" id="template-page">
    <link rel="stylesheet" href="/css/template.css">

    <!-- Dashboard Stats Cards -->
    <div class="stats-dashboard">
        <!-- Static Total card removed, now rendered dynamically inside language grid -->

        <!-- Dynamic language cards will be inserted here -->
        <div id="language-stats-container" class="language-stats-grid"></div>
    </div>

    <!-- UNIFIED CONTROLS BAR -->
    <div class="unified-controls-bar" id="template-controls">
        <!-- Left: Add Button -->
        <div class="controls-left">
            <button id="btn-new-template" class="primary-btn">
                <span class="btn-icon">+</span>
                New Message
            </button>
        </div>

        <!-- Middle: Search and Filters -->
        <div class="controls-middle">
            <input type="text" id="search-templates" class="search-input" placeholder="üîç Search templates...">

            <select id="filter-language" class="filter-select">
                <option value="">All Languages</option>
            </select>

            <select id="filter-category" class="filter-select">
                <option value="">All Categories</option>
            </select>
        </div>

        <!-- Right: View Mode Toggle -->
        <div class="controls-right">
            <div class="view-mode-toggle">
                <button class="view-btn" data-view="list" title="List View">
                    <span class="view-icon">‚ò∞</span>
                </button>
                <button class="view-btn active" data-view="card" title="Card View">
                    <span class="view-icon">‚ñ¶</span>
                </button>
                <button class="view-btn" data-view="detailed" title="Detailed View">
                    <span class="view-icon">‚ñ•</span>
                </button>
            </div>
        </div>
    </div>

    <!-- LIST VIEW CONTAINER -->
    <div id="template-list-container" class="template-list-container">
        <!-- Rendered by JS -->
    </div>

    <!-- EDITOR CONTAINER -->
    <div id="template-editor-container" class="hidden" style="display: flex; flex-direction: column; height: 100%;">

        <!-- 1. HEADER (Metadata) -->
        <div class="editor-header"
            style="flex-shrink: 0; padding: 1rem 2rem; border-bottom: 1px solid var(--border); background: var(--bg-panel); display: flex; align-items: center; gap: 2rem;">
            <button id="btn-back-to-list" class="action-btn-secondary" style="margin-right: 1rem;">
                ‚Üê Back
            </button>

            <div style="flex: 1; display: flex; gap: 1rem; align-items: center;">
                <input type="text" id="template-name-input" class="modern-input" placeholder="Template Name"
                    style="font-weight: 700; font-size: 1.1rem;">

                <select id="template-language-select" class="modern-input" style="width: 180px;">
                    <option value="">Select Language</option>
                </select>

                <select id="template-category-select" class="modern-input" style="width: 180px;">
                    <option value="">Select Category</option>
                </select>
            </div>
        </div>

        <!-- 2. STUDIO GRID (3 Columns) - NO PREVIEW DASHBOARD -->
        <div class="editor-layout-grid">

            <!-- LEFT: MEDIA -->
            <div class="editor-col editor-panel">
                <div class="panel-title">Header Media</div>

                <!-- Media Preview (Visual) -->
                <div id="wa-media-preview" class="media-preview-box hidden"
                    style="width:100%; aspect-ratio:16/9; background:#000; border-radius:8px; overflow:hidden; margin-bottom:1rem;">
                </div>
                <div id="wa-media-placeholder" class="media-preview-placeholder"
                    style="width:100%; aspect-ratio:16/9; background:rgba(255,255,255,0.05); border:1px dashed rgba(255,255,255,0.2); border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--text-muted); font-size:0.8rem; margin-bottom:1rem;">
                    <span>No Media Selected</span>
                </div>

                <!-- Media Controls -->
                <div id="wa-media-controls" class="wa-media-controls">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <select id="media-type-select" class="modern-input">
                            <option value="none">No Media</option>
                            <option value="image">Image</option>
                            <option value="video">Video</option>
                            <option value="document">Document</option>
                        </select>

                        <div id="media-upload-area" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                <button id="btn-open-media-library" class="cta-button"
                                    style="background: rgba(255,255,255,0.1); border: 1px dashed rgba(255,255,255,0.2); flex: 1; justify-content: center; font-size: 0.8rem; padding: 0.5rem;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                        viewBox="0 0 24 24" style="margin-right: 4px;">
                                        <path
                                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    Library
                                </button>
                                <button id="btn-upload-pc" class="cta-button"
                                    style="background: rgba(255,255,255,0.1); border: 1px dashed rgba(255,255,255,0.2); flex: 1; justify-content: center; font-size: 0.8rem; padding: 0.5rem;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                        viewBox="0 0 24 24" style="margin-right: 4px;">
                                        <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                    </svg>
                                    Upload
                                </button>
                            </div>
                            <input type="file" id="media-file-input" class="hidden"
                                accept="image/*,video/*,application/pdf">

                            <div style="text-align: center; font-size: 0.8rem; color: var(--text-muted);">OR</div>

                            <input type="text" id="media-url-input" class="modern-input"
                                placeholder="Paste Image/Video URL">
                        </div>
                    </div>
                </div>
            </div>

            <!-- CENTER: CONTENT (Text Only) -->
            <div class="editor-col editor-col-center">

                <!-- Main Message Body -->
                <div class="content-card"
                    style="width: 100%; background: var(--bg-panel); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border);">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <div
                            style="color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; font-weight: 700;">
                            Message Body
                        </div>
                        <button id="btn-translate-editor" class="text-xs pill-btn"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 2px 8px;">
                            üåç Translate
                        </button>
                    </div>
                    <div class="wa-text-content cursor-text editable-preview" id="wa-text-preview"
                        contenteditable="true"
                        data-placeholder="Type your message here... (Supports *bold*, _italic_, ~strike~)"
                        style="min-height: 200px; font-size: 1rem; line-height: 1.6; color: var(--text-primary); outline: none;">
                    </div>
                </div>

                <!-- Footer -->
                <div class="content-card"
                    style="width: 100%; background: var(--bg-panel); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-top: 1rem;">
                    <div
                        style="color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; font-weight: 700; margin-bottom: 0.5rem;">
                        Footer (Optional)</div>
                    <div class="wa-footer cursor-text editable-preview" id="wa-footer-preview" contenteditable="true"
                        data-placeholder="Add a footer text..."
                        style="font-size: 0.9rem; color: var(--text-muted); outline: none;"></div>
                </div>
                <!-- Status Message -->
                <div id="status-message" class="text-sm font-bold hidden"
                    style="color:#10b981; text-align:center; margin-top: 1rem;">Message Sent!</div>
            </div>

            <!-- RIGHT: ACTIONS & BUTTONS -->
            <div class="editor-col editor-panel">

                <!-- Buttons Card -->
                <div class="panel-section">
                    <div class="panel-title">Interactive Buttons</div>

                    <!-- Buttons List (Visual) moved here -->
                    <div id="wa-buttons-preview" class="wa-buttons-container"
                        style="flex-direction: column; align-items: stretch; gap: 0.5rem; margin-bottom: 1rem;"></div>

                    <!-- Add Button -->
                    <div id="wa-button-add" class="wa-button-add">
                        <button class="pill-btn" style="width: 100%;">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                viewBox="0 0 24 24" style="margin-right: 4px;">
                                <path d="M12 4v16m8-8H4"></path>
                            </svg>
                            Add Button
                        </button>
                    </div>

                    <!-- Button Edit Form -->
                    <div id="wa-button-edit-form" class="wa-button-edit-form hidden"
                        style="margin-top: 1rem; border: 1px solid var(--border); padding: 1rem; border-radius: 8px;">
                        <h4 style="font-size: 0.8rem; margin-bottom: 0.5rem; text-transform: uppercase;">Edit Button
                        </h4>
                        <div style="display: flex; gap: 0.5rem; flex-direction: column;">
                            <select id="btn-type-input" class="modern-input small">
                                <option value="reply">Quick Reply</option>
                                <option value="url">URL Action</option>
                                <option value="call">Phone Number</option>
                                <option value="chat">Chat Button</option>
                                <option value="copy">Copy Code</option>
                            </select>

                            <label id="btn-dynamic-kam-wrapper" class="hidden"
                                style="display:flex; align-items:center; gap:8px; font-size:0.8rem; margin-bottom: 4px;">
                                <input type="checkbox" id="btn-dynamic-kam">
                                <span>Use assigned KAM phone number</span>
                            </label>
                            <input type="text" id="btn-text-input" class="modern-input small"
                                placeholder="Button Label">
                            <input type="text" id="btn-value-input" class="modern-input small hidden"
                                placeholder="Value (URL/Phone)">
                            <!-- Chat Button Specific Fields -->
                            <input type="text" id="btn-chat-phone-input" class="modern-input small hidden"
                                placeholder="Phone Number (e.g., 919876543210)">
                            <textarea id="btn-chat-message-input" class="modern-input small hidden"
                                placeholder="Pre-filled message (optional)" rows="3"
                                style="resize: vertical; font-family: inherit;"></textarea>
                            <button id="btn-confirm" class="pill-btn primary-btn"
                                style="width: 100%; justify-content: center;">Confirm</button>
                            <button id="btn-delete-button" class="action-btn-secondary"
                                style="color: #ef4444; border-color: rgba(239,68,68,0.3); margin-top: 0.5rem;">Delete</button>
                        </div>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid var(--border); margin: 0;">

                <!-- Sample Message / Testing -->
                <div class="panel-section">
                    <div class="panel-title">Test & Save</div>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label
                                style="display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.4rem;">Sender
                                KAM (For Dynamic Buttons)</label>
                            <!-- KAM Selector Container -->
                            <div id="test-kam-selector-container"></div>
                        </div>

                        <div>
                            <label
                                style="display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.4rem;">Testing
                                Session</label>
                            <select id="session-select" class="modern-input">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        <div>
                            <label
                                style="display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.4rem;">Receiver
                                Number</label>
                            <input type="text" id="phone-number" class="modern-input" placeholder="e.g. 919876543210">
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button id="btn-send-message" class="cta-button"
                            style="background: #0f1523; border: 1px solid var(--primary); color: var(--primary);">
                            Test Send
                        </button>
                        <button id="btn-save-template" class="cta-button">
                            Save Template
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>