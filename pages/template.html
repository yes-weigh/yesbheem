<div class="template-grid-container" id="template-page">
    <link rel="stylesheet" href="/css/template.css">

    <!-- SIDEBAR -->
    <aside class="template-sidebar">
        <div>
            <button id="btn-new-template" class="cta-button">
                <span>+ New Message</span>
            </button>
        </div>
        <div class="sidebar-title" style="margin-top: 1rem;">Saved Templates</div>
        <div class="sidebar-list" id="template-list">
            <!-- Filled by JS -->
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="template-main">
        <!-- HEADER -->
        <header class="composer-header">
            <div class="header-group" style="flex: 0 0 220px;">
                <label class="header-label">From Device</label>
                <select id="session-select" class="minimal-input" style="cursor: pointer;">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="header-group"
                style="flex: 0 0 200px; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 1.5rem;">
                <label class="header-label">Receiver</label>
                <input type="text" id="phone-number" class="minimal-input" placeholder="e.g. 919876543210">
            </div>
            <div class="header-group"
                style="flex: 1; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 1.5rem;">
                <label class="header-label">Template Name</label>
                <input type="text" id="template-name-input" class="minimal-input" placeholder="My New Template">
            </div>
            <div class="header-group" style="text-align: right;">
                <label class="header-label">ID</label>
                <span id="template-id-display" style="font-size: 0.8rem; font-weight: 700; color: #a5b4fc;">NEW</span>
            </div>
        </header>

        <!-- TWO COLUMN LAYOUT -->
        <div class="editor-layout-grid">

            <!-- LEFT: LIVE PREVIEW -->
            <div class="editor-side-col">
                <div style="position: sticky; top: 0;">
                    <h5 class="text-muted text-xs font-bold uppercase mb-4 text-center"
                        style="font-size: 0.7rem; letter-spacing: 1px;">Live Preview (Click to Edit)</h5>

                    <div class="wa-preview-container">
                        <div class="wa-header">
                            <div class="wa-avatar"></div>
                            <div style="flex:1;">
                                <div style="font-size:14px; font-weight:600;">Business Name</div>
                                <div style="font-size:11px; opacity:0.7;">Official Business Account</div>
                            </div>
                        </div>
                        <div class="wa-body">
                            <!-- BUBBLE -->
                            <div class="wa-message-bubble">
                                <!-- Media -->
                                <div id="wa-media-preview" class="wa-media-container hidden cursor-pointer"
                                    onclick="window.tmplMgr.focusSection('media')"></div>
                                <div id="wa-media-placeholder"
                                    class="wa-media-container dashed-border cursor-pointer hidden"
                                    onclick="window.tmplMgr.focusSection('media')">
                                    <div style="text-align:center; color:rgba(255,255,255,0.3);">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                                            viewBox="0 0 24 24" style="margin: 0 auto 4px auto;">
                                            <path
                                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        <span style="font-size:10px;">Add Media</span>
                                    </div>
                                </div>

                                <!-- Text -->
                                <div class="wa-text-content cursor-pointer" id="wa-text-preview"
                                    onclick="window.tmplMgr.focusSection('text')">...</div>

                                <!-- Footer -->
                                <div class="wa-footer hidden cursor-pointer" id="wa-footer-preview"
                                    onclick="window.tmplMgr.focusSection('footer')"></div>

                                <div class="wa-time">Now</div>
                            </div>

                            <!-- BUTTONS -->
                            <div id="wa-buttons-preview" class="wa-buttons-container cursor-pointer"
                                onclick="window.tmplMgr.focusSection('buttons')"></div>
                            <div id="wa-buttons-placeholder" class="wa-buttons-container cursor-pointer hidden"
                                onclick="window.tmplMgr.focusSection('buttons')">
                                <div
                                    style="border:1px dashed rgba(255,255,255,0.2); padding:8px; border-radius:8px; text-align:center;">
                                    <span style="font-size:11px; color:rgba(255,255,255,0.4);">+ Add Buttons</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align:center; margin-top:1rem;">
                        <button id="btn-delete-template"
                            style="color: #ef4444; font-size:0.8rem; background:none; border:none; text-decoration:underline; cursor:pointer; opacity:0; pointer-events:none;">Delete
                            Template</button>
                    </div>
                </div>
            </div>

            <!-- RIGHT: EDITOR -->
            <div class="editor-main-col">
                <div class="editor-card">
                    <!-- Composer Body -->
                    <div class="composer-body">
                        <!-- Tab Bar -->
                        <div class="action-bar">
                            <button class="action-pill active" id="btn-trigger-text"
                                onclick="window.tmplMgr.focusSection('text')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path d="M4 6h16M4 12h16M4 18h7"></path>
                                </svg>
                                Message
                            </button>
                            <button class="action-pill" id="btn-trigger-media"
                                onclick="window.tmplMgr.focusSection('media')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                                Media
                            </button>
                            <button class="action-pill" id="btn-trigger-buttons"
                                onclick="window.tmplMgr.focusSection('buttons')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                Buttons <span id="btn-count-badge"
                                    style="background:rgba(255,255,255,0.1); padding:0 6px; border-radius:10px; font-size:0.7rem; margin-left:4px;">0</span>
                            </button>
                            <button class="action-pill" id="btn-trigger-footer"
                                onclick="window.tmplMgr.focusSection('footer')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path d="M4 6h16M4 12h16m-7 6h7"></path>
                                </svg>
                                Footer
                            </button>
                        </div>

                        <!-- SECTIONS -->

                        <!-- 1. TEXT SECTION -->
                        <div id="text-input-section" class="input-section">
                            <textarea id="message-body" class="message-textarea"
                                placeholder="Type your WhatsApp message here... (Supports *bold*, _italic_, ~strike~)"></textarea>
                        </div>

                        <!-- 2. MEDIA SECTION -->
                        <div id="media-input-section" class="input-section section-inset hidden">
                            <div class="flex gap-2 mb-2" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <button class="pill-btn toggle-btn active small" data-source="url">URL</button>
                                <button class="pill-btn toggle-btn small" data-source="file">Upload</button>
                                <select id="media-type-select" class="modern-input small" style="width: auto;">
                                    <option value="image">Image</option>
                                    <option value="video">Video</option>
                                </select>
                            </div>
                            <input type="text" id="media-url-input" class="modern-input" placeholder="Media URL...">
                            <input type="file" id="media-file-input" class="modern-input hidden">
                            <div class="text-xs text-muted mt-2">Media will appear at the top of the message.</div>
                        </div>

                        <!-- 3. BUTTONS SECTION -->
                        <div id="buttons-input-section" class="input-section section-inset hidden">
                            <div id="buttons-list"></div>
                            <button id="btn-add-button" class="btn-add-dashed w-full py-2 text-xs"
                                style="width:100%; padding:8px;">+ Add Button</button>
                        </div>

                        <!-- 4. FOOTER SECTION -->
                        <div id="footer-input-container" class="input-section section-inset border-top hidden">
                            <label class="text-xs font-bold uppercase text-muted mb-1 block">Footer Text</label>
                            <input type="text" id="footer-input" class="minimal-input"
                                placeholder="Type footer text...">
                        </div>
                    </div>
                </div>

                <!-- Submit Area -->
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button id="btn-save-template" class="action-button-large btn-glass" style="flex:1;">Save
                        Template</button>
                    <button id="btn-send-message" class="action-button-large btn-primary" style="flex:2;">Send
                        Message</button>
                </div>
                <div id="status-message" class="text-sm font-bold hidden" style="color:#10b981; text-align:center;">
                    Message Sent!</div>
            </div>
        </div>
    </main>
</div>

<script src="/js/services/template_service.js"></script>
<script src="/js/renderers/template_renderer.js"></script>
<script src="/js/template_manager.js"></script>