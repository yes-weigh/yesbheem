<div class="page-container" id="dashboard-page">
    <div class="page-title-bar">
        <div class="page-title-content">
            <!-- Breadcrumbs Removed -->
            <div style="flex: 1;"></div> <!-- Spacer -->

            <!-- Injected Stats Container -->
            <div class="dashboard-stats" id="dashboard-stats">
                <!-- Stats will be injected here via JS -->
            </div>
        </div>
    </div>

    <!-- Map Content -->
    <div class="dashboard-iframe-wrapper">
        <iframe src="pages/map.html" frameborder="0" class="dashboard-iframe" title="Sales Intelligence Map"></iframe>
    </div>
</div>

<script>
    console.log('Dashboard script loaded');
    window.addEventListener('message', function (event) {
        if (event.data.type === 'STATS_UPDATE') {
            const data = event.data.data;
            const container = document.getElementById('dashboard-stats');

            if (container) {
                // Horizontal layout for header
                container.innerHTML = `
                    <div class="stat-item">
                        <span class="stat-label">ACHIEVEMENT</span>
                        <span class="stat-value" style="color: ${getAchievementColor(data.achievement)}">${formatNumber(data.achievement)}%</span>
                    </div>
                    <div class="stat-separator"></div>
                    <div class="stat-item">
                        <span class="stat-label">SALES</span>
                        <span class="stat-value">₹${formatCurrency(data.currentSales)}</span>
                    </div>
                    <div class="stat-separator"></div>
                    <div class="stat-item">
                        <span class="stat-label">DEALERS</span>
                        <span class="stat-value">${data.dealerCount}</span>
                    </div>
                    <div class="stat-separator"></div>
                    <div class="stat-item">
                        <span class="stat-label">TARGET</span>
                        <span class="stat-value">₹${formatCurrency(data.monthlyTarget)}</span>
                    </div>
                `;
            }
        }
    });

    function getAchievementColor(val) {
        if (val >= 100) return '#4caf50'; // Green
        if (val >= 70) return '#ff9800';  // Orange
        return '#f44336';                 // Red
    }

    function formatNumber(num) {
        if (!num) return '0';
        return parseFloat(num).toFixed(1);
    }

    function formatCurrency(val) {
        if (!val) return '0';

        let num = parseFloat(val);
        if (isNaN(num)) return val;

        // Indian Number System Formatting
        if (num >= 10000000) { // 1 Crore
            return (num / 10000000).toFixed(2) + ' Cr';
        } else if (num >= 100000) { // 1 Lakh
            return (num / 100000).toFixed(2) + ' L';
        } else if (num >= 1000) { // 1 Thousand
            return (num / 1000).toFixed(1) + ' k';
        }

        return num.toFixed(0);
    }
</script>

<style>
    .page-title-bar {
        height: 35px;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-light);
        display: flex;
        align-items: center;
        padding: 0 16px;
    }

    .page-title-content {
        display: flex;
        align-items: center;
        width: 100%;
        justify-content: flex-start;
        /* items will be pushed by spacer */
    }

    .dashboard-stats {
        display: flex;
        align-items: center;
        gap: 24px;
        font-family: 'Outfit', sans-serif;
        margin-left: 0;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }

    .stat-label {
        color: var(--text-muted);
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .stat-value {
        color: var(--text-main);
        font-weight: 600;
    }

    .stat-separator {
        width: 1px;
        height: 14px;
        background: var(--border-light);
    }

    .dashboard-iframe-wrapper {
        width: 100%;
        height: calc(100% - 35px);
        overflow: hidden;
    }

    .dashboard-iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
    }
</style>