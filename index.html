<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yes Bheem Dashboard - Sales intelligence and analytics platform">
    <title>Yes Bheem - Sales Intelligence</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Set base path dynamically -->
    <script>
        // Detect base path from URL
        const pathname = window.location.pathname;
        let basePath = '/';

        // Check if we're in a subdirectory (e.g., /yesbheem/)
        // But ignore app routes (SPA routes)
        const appRoutes = ['/dashboard', '/dealer', '/discussions', '/instance', '/message', '/b2b-leads', '/product', '/pricelist', '/media', '/yesbheem', '/template', '/broadcast', '/welcome', '/chatbot', '/groupgrabber', '/report', '/integration', '/settings', '/cirtificates'];
        const isAppRoute = appRoutes.some(route => pathname.startsWith(route));

        const match = pathname.match(/^(\/[^\/]+)\//);
        if (match && match[1] !== '' && !isAppRoute) {
            basePath = match[1] + '/';
        }

        // Set base tag using document.write to block preloader requests relative to wrong path
        document.write('<base href="' + window.location.origin + basePath + '">');
    </script>

    <!-- Modular CSS -->
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/components.css?v=2">
    <link rel="stylesheet" href="/css/map.css">
    <link rel="stylesheet" href="/css/settings.css">
    <link rel="stylesheet" href="/css/discussions.css?v=4">
</head>

<body>
    <!-- Initial Loading Overlay to prevent FOUC -->
    <div id="initial-loader"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #050505; z-index: 10000; display: flex; align-items: center; justify-content: center; color: white; font-family: sans-serif;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="3"
                stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
            </svg>
            <span
                style="font-size: 0.9rem; opacity: 0.7; animation: pulse 1.5s ease-in-out infinite;">Authenticating...</span>
        </div>
        <style>
            @keyframes spin {
                100% {
                    transform: rotate(360deg);
                }
            }

            @keyframes pulse {

                0%,
                100% {
                    opacity: 0.5;
                }

                50% {
                    opacity: 1;
                }
            }
        </style>
    </div>

    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Fixed Title Bar -->
    <header class="title-bar">
        <div class="title-bar-content">
            <div class="title-bar-left">
                <!-- Branding replaces toggle button -->
                <div class="title-bar-brand" id="mobile-sidebar-toggle" style="cursor: pointer;" title="Toggle Sidebar">
                    <h1>Yes Bheem</h1>
                </div>
            </div>
            <div class="title-bar-right">
                <div class="user-badge-container">
                    <div class="user-badge" id="user-badge">
                        <div class="user-avatar-small">U</div>
                        <span class="user-name-small">User</span>
                        <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                            <path d="M6 8L2 4h8z" />
                        </svg>
                    </div>
                    <div class="theme-dropdown" id="theme-dropdown">
                        <div class="dropdown-item" data-theme="dark">
                            <span class="theme-icon">ğŸŒ™</span>
                            <span>Dark Theme</span>
                            <span class="checkmark">âœ“</span>
                        </div>
                        <div class="dropdown-item" data-theme="light">
                            <span class="theme-icon">â˜€ï¸</span>
                            <span>Light Theme</span>
                            <span class="checkmark">âœ“</span>
                        </div>
                        <div class="dropdown-divider"
                            style="height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0;"></div>
                        <div class="dropdown-item" id="sign-out-button" style="color: #ff6b6b;">
                            <span class="theme-icon">ğŸšª</span>
                            <span>Sign Out</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <!-- Collapsible Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Navigation Menu -->
            <nav class="nav-menu">
                <div class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Dashboard</span>
                </div>
                <div class="nav-item" data-page="discussions">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">Tasks</span>
                </div>
                <div class="nav-item" data-page="dealer">
                    <span class="nav-icon">ğŸ¤</span>
                    <span class="nav-text">Dealer</span>
                </div>
                <div class="nav-item" data-page="instance">
                    <span class="nav-icon">ğŸ–¥ï¸</span>
                    <span class="nav-text">Instance</span>
                </div>
                <div class="nav-item" data-page="template">
                    <span class="nav-icon">ğŸ“„</span>
                    <span class="nav-text">Template</span>
                </div>
                <div class="nav-item" data-page="campaign">
                    <span class="nav-icon">ğŸ“¡</span>
                    <span class="nav-text">Campaign</span>
                </div>
                <div class="nav-item" data-page="yesbheem">
                    <span class="nav-icon">âš¡</span>
                    <span class="nav-text">Yes Bheem</span>
                </div>
                <div class="nav-item" data-page="b2b-leads">
                    <span class="nav-icon">ğŸ‘¤</span>
                    <span class="nav-text">B2B Leads</span>
                </div>
                <div class="nav-item" data-page="media">
                    <span class="nav-icon">ğŸ–¼ï¸</span>
                    <span class="nav-text">Media</span>
                </div>
                <div class="nav-item" data-page="welcome">
                    <span class="nav-icon">ğŸ‘‹</span>
                    <span class="nav-text">Welcome</span>
                </div>
                <div class="nav-item" data-page="chatbot">
                    <span class="nav-icon">ğŸ¤–</span>
                    <span class="nav-text">Chatbot</span>
                </div>
                <div class="nav-item" data-page="groupgrabber">
                    <span class="nav-icon">ğŸ”—</span>
                    <span class="nav-text">Group Grabber</span>
                </div>
                <div class="nav-item" data-page="report">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span class="nav-text">Report</span>
                </div>
                <div class="nav-item" data-page="product">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">Product</span>
                </div>
                <div class="nav-item" data-page="pricelist">
                    <span class="nav-icon">ğŸ·ï¸</span>
                    <span class="nav-text">Pricelist</span>
                </div>
                <div class="nav-item" data-page="service">
                    <span class="nav-icon">ğŸ”§</span>
                    <span class="nav-text">Service</span>
                </div>
                <div class="nav-item" data-page="driver">
                    <span class="nav-icon">ğŸš—</span>
                    <span class="nav-text">Driver</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">Settings</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content">
            <!-- Dynamic page content loaded here -->
            <div id="page-content">
                <!-- Content will be loaded by nav_controller.js -->
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Configuration (must load first) -->
    <script src="/js/config.js"></script>
    <!-- Theme Manager -->
    <script src="/js/theme_manager.js"></script>
    <!-- Navigation Controller -->
    <script src="/js/nav_controller.js?v=7"></script>

    <!-- SYSTEM SECURITY LAYER -->
    <script type="module" src="/js/security_overlay.js"></script>
</body>

</html>